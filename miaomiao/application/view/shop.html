<!doctype html>
<html lang="zh-cn">
    
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>购买/续费 服务器</title>
        <link rel="stylesheet" href="../static/style/font-awesome/css/font-awesome.css?ver=4.25">
        <link rel="stylesheet" href="../static/style/skin/metro.css?ver=4.25">
        <link rel="stylesheet" href="./public/style/common.css">
        <link rel="stylesheet" href="./public/style/index.css">
		<script src="./public/js/jquery-3.2.1.min.js"></script>
    </head>
    
    <body>
        <div id="body">
            <div class="menu-left">
                <h1>商店</h1>
                <ul class="setting">
    				<a href="index.php?c=shop" id="member" draggable="false" class="selected" style="position: relative;"><i class="font-icon icon-group"></i>购买 / 续费</a>
    				<a href="index.php" id="system" draggable="false"  style="position: relative;"><i class="font-icon icon-cog"></i>管理服务器</a>
    			</ul>
            </div>
            <div class="app-content main app-plugins">
    			<div class="app-model app-content-box">
    				<div class="h1">
    				    &nbsp;&nbsp;<i class="font-icon icon-yen"></i>余额: <span class="price" id="price"><?php echo $money; ?></span> <span>颗猫粮</span>&nbsp;&nbsp;<button class="btn btn-success">购买猫粮</button>
    				</div>
    				<ul class="app-list" id="app-list" style="display: flex;">
						<?php foreach ($shopInfo as $shop) {?>
                		<li class="app-li ripple-item data-app" title="CPU: E5 2697v3&#10;内存:128G" >
                			<div class="flag-box">
                			    <div class="flag bg-orange-7"><?php echo $shop['shop_server_tag']; ?></div>
                			</div>
                			<div class="icon">
                				<img src="./public/images/<?php echo $shop['shop_server_avatar']; ?>" draggable="false" style="padding-top: 10px;">
                			</div>
                			<div class="text">
                				<div class="name"><?php echo $shop['shop_server_name']; ?></div>
                				<div class="copyright">
                				    CPU：<span class="cpu"><?php echo $shop['shop_server_core']; ?></span>核心<br>
                				    内存：<span class="memory"><?php echo $shop['shop_server_memory']/1024; ?>G</span>
                				</div>
                				<div class="pay">
                				    <span class="price"><?php echo $shop['shop_server_price']; ?></span><span class="price-name"> 颗猫粮 / <span class="price"><?php if($shop['shop_server_month']==1){echo "月";}else if($shop['shop_server_month']==6){echo "半年";}else if($shop['shop_server_month']==12){echo "年";}?></span></span>
                				</div>
                			</div>
                			<div class="action btn-group">
        						<button class="btn btn-sm btn-success buy-btn" type="button" shop-id="<?php echo $shop['shopid'];?>">
        							<span>购买</span>
        						</button>
                			</div>
                			<div class="progress hidden">
                				<span class="total-size"></span>
                				<span class="download-speed"></span>
                				<div class="progress-bar"></div>
                			</div>
                		</li>
						<?php } ?>
            		</ul>
    			</div>
				<div id="confirm"  class="dialog-path-remove artDialog undefined aui-state-lock aui-state-focus aui-state-drag" style="display:none;position: absolute;left: 25%;top: 25%;width: auto;z-index: 312;min-width: 340px;"><div class="aui-outer"><div class="aui-mask"></div><table class="aui-border"><tbody><tr><td class="aui-nw"></td><td class="aui-n"></td><td class="aui-ne"></td></tr><tr><td class="aui-w"></td><td class="aui-c"><div class="aui-inner"><table class="aui-dialog"><tbody><tr><td colspan="2" class="aui-header"><div class="aui-title-bar dialog-menu" id="dialog-path-remove"><div class="aui-title" style="cursor: move;"><img src="../static/images/file_icon/icon_others/info.png" draggable="false" ondragstart="return false;">确认购买？</div><a class="aui-min"></a><a class="aui-max"></a><a class="aui-close"></a></div></td></tr><tr><td class="aui-icon"><div class="aui-icon-bg" style="background-image: url(&quot;http://kode.miaocraft.com/static/js/lib/artDialog/icons/question.png&quot;); background-repeat: no-repeat; background-position: center center;"></div></td><td class="aui-main" style="padding: 40px; width: auto; height: auto;"><div class="aui-content"><div style="width:200px" class="can-select" id="confirmText">您确定要花50颗猫粮购买套餐吗？</div></div></td></tr><tr><td colspan="2" class="aui-footer"><div class="aui-buttons"><button class="aui-state-highlight" type="button">确定</button><button type="button" id="cancel">取消</button></div></td></tr></tbody></table></div></td><td class="aui-e"></td></tr><tr><td class="aui-sw"></td><td class="aui-s"></td><td class="aui-se"></td></tr></tbody></table><div class="resize-handle resize-top" resize="top"></div><div class="resize-handle resize-right" resize="right"></div><div class="resize-handle resize-bottom" resize="bottom"></div><div class="resize-handle resize-left" resize="left"></div><div class="resize-handle resize-top-right" resize="top-right"></div><div class="resize-handle resize-bottom-right" resize="bottom-right"></div><div class="resize-handle resize-bottom-left" resize="bottom-left"></div><div class="resize-handle resize-top-left" resize="top-left"></div></div></div>
				<div id="uuid_1521273415_1213" class="tips-box error" style="display: none;left: 45%; opacity: 1; top: 25%;"><i class="tips-icon"></i><div class="tips-msg"><p>购买失败，猫粮不足</p></div><a class="tips-close">×</a><div style="clear:both"></div></div>
				<div id="uuid_1521273415_1214" class="tips-box success" style="display: none;left: 45%; opacity: 1; top: 25%;"><i class="tips-icon"></i><div class="tips-msg"><p>购买成功！</p></div><a class="tips-close">×</a><div style="clear:both"></div></div>

				<div class="app-model app-descript can-select can-right-menu hidden"></div>
		</div>
<script>
	$(function(){
		$(".buy-btn").click(function(){
		    var name = $(this).parent().prev().children(".name").text();
		    var price = $(this).parent().prev().children(".pay").children(".price").text();
		    $("#confirmText").text("您确定要花"+price+"颗猫粮购买"+name+"吗？");
            $(".aui-state-highlight").attr("shop-id",$(this).attr("shop-id"));
            $(".aui-state-highlight").attr("shop-price",price);
		    $("#confirm").show();
		});
		$(".aui-state-highlight").click(function () {
			var shopid = $(this).attr("shop-id");
			var price = $(this).attr("shop-price");
			$.ajax({
				type: "post",
				url: "index.php?c=shop&a=buy",
				data: "shopid="+shopid,
				success: function(data){
					if(data=="true"){
					    $("#confirm").hide();
					    $(".tips-box.success").show(1000);
					    $("#price").text($("#price").text()*1-price);
                        setTimeout(function(){$(".tips-box.success").hide(1000)},2000);
					}else {
                        $("#confirm").hide();
                        $(".tips-box.error").show(1000);
                        setTimeout(function(){$(".tips-box.error").hide(1000)},3000);
					}
				}
			})
        });
		$(".tips-close").click(function(){
		    $(".tips-box.error").hide(1000);
		})
		$(".aui-close").click(function(){
			$("#confirm").hide();
		});
		$("#cancel").click(function(){
            $("#confirm").hide();
		})

	})
</script>
    </body>
</html>